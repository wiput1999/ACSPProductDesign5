<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta charset="utf-8" />
  <meta name="description" content="ร่วมโหวตเสื้อกันหนาวโรงเรียนในโครงการ ACSP Product Design ปีที่ 5" />
  <meta name="author" content="สภานักเรียนอัสสัมชัญสมุทรปราการ"/>
  <meta property="og:type" content="website"/>
  <meta property="og:author" content="https://www.facebook.com/ACPowerParty"/>
  <meta property="og:image" content="http://acspsc.com/img/og_image.png"/>
  <meta property="og:url" content="http://acspsc.com/"/>
  <meta name="theme-color" content="#ff1e00"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>ACSP Product Design #5</title>

  <link rel="icon" href="img/logo.png">
  

  <link rel="stylesheet" href="css/custom.css" />
  <link rel="stylesheet" href="css/uikit.almost-flat.css" />
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.10.1/sweetalert2.min.css" />

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/4.5.0/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/4.5.0/firebase-auth.js"></script>
  <script defer src="/__/firebase/4.5.0/firebase-database.js"></script>
  <script defer src="/__/firebase/4.5.0/firebase-messaging.js"></script>
  <script defer src="/__/firebase/4.5.0/firebase-storage.js"></script>
  <!-- initialize the SDK after all desired features are loaded -->
  <script defer src="/__/firebase/init.js"></script>



</head>
<body>

  <div class="hero">
    <center><img src="img/logo.png" class="logo" /></center>
    <center><img src="img/hero.png" class="hero" /></center>
  </div>
  <div class="votes-open">
    <center><img src="img/votes_open.png" class="text" /></center>
  </div>
  <div class="uk-container uk-container-center">
    <div class="uk-grid">
      <div class="uk-width-medium-1-2">
        <figure class="uk-overlay uk-overlay-hover">
          <a href="img/v1_full.jpg" data-uk-lightbox="{group:'style'}">
            <img class="uk-thumbnail" src="img/v1_thumb.jpg" width="100%" />
            <img class="uk-thumbnail uk-overlay-panel uk-overlay-image uk-overlay-fade" src="img/v1_thumb_h.png" width="100%" />
          </a>
        </figure>
      </div>
      <div class="uk-width-medium-1-2">
        <figure class="uk-overlay uk-overlay-hover">
          <a href="img/v2_full.jpg" data-uk-lightbox="{group:'style'}">
            <img class="uk-thumbnail" src="img/v2_thumb.jpg" width="100%" />
            <img class="uk-thumbnail uk-overlay-panel uk-overlay-image uk-overlay-fade" src="img/v2_thumb_h.png" width="100%" />
          </a>
        </figure>
      </div>
      <div class="uk-width-medium-1-2">
        <figure class="uk-overlay uk-overlay-hover">
          <a href="img/v3_full.jpg" data-uk-lightbox="{group:'style'}">
            <img class="uk-thumbnail" src="img/v3_thumb.jpg" width="100%" />
            <img class="uk-thumbnail uk-overlay-panel uk-overlay-image uk-overlay-fade" src="img/v3_thumb_h.png" width="100%" />
          </a>
        </figure>
      </div>
      <div class="uk-width-medium-1-2">
        <figure class="uk-overlay uk-overlay-hover">
          <a href="img/v4_full.jpg" data-uk-lightbox="{group:'style'}">
            <img class="uk-thumbnail" src="img/v4_thumb.jpg" width="100%" />
            <img class="uk-thumbnail uk-overlay-panel uk-overlay-image uk-overlay-fade" src="img/v4_thumb_h.png" width="100%" />
          </a>
        </figure>
      </div>
    </div>
  </div>
  <div class="login">
    <div class="uk-container uk-container-center">
      <div class="uk-grid uk-grid-medium">
        <div class="uk-width-medium-1-1 uk-text-center">
            <h2>Please login with Facebook to vote</h2>
            <button class="uk-button uk-button-primary uk-button-large" name="submit" onclick="onSignInButtonClick()" >Login with Facebook</button>
        </div>
      </div>
    </div>
  </div>
  <div class="vote" style="display: none;">
    <div class="uk-container uk-container-center">
      <form class="uk-form" method="post">
        <div class="uk-grid uk-grid-medium">
          <div class="uk-width-medium-1-2">
            <fieldset>
              <div class="uk-form-row">
                <div class="uk-form-select uk-width-1-1" data-uk-form-select>
                  <h2 id="login-status">Status</h2>
                  <select class="uk-button uk-form-large uk-width-1-1" name="style" id="style">
                    <option value="0">คลิกที่นี่เพื่อเลือกแบบที่ต้องการโหวต</option>
                    <option value="1">โหวตแบบที่ 1</option>
                    <option value="2">โหวตแบบที่ 2</option>
                    <option value="3">โหวตแบบที่ 3</option>
                    <option value="4">โหวตแบบที่ 4</option>
                  </select>
                </div>
              </div>
              <div class="uk-form-row">
                <a class="uk-button uk-button-success uk-button-large uk-width-1-1" id="btn-send" type="submit" onclick="onVoteButtonClick()" >โหวต</a>
                <br>
                <br>
                <a class="uk-button uk-button-primary uk-button-large uk-width-1-1" id="btn-send" type="submit" onclick="onSignOutButtonClick()" >Logout</a>
              </div>
            </fieldset>
          </div>
          <div class="uk-width-medium-1-2">
            <h2>รายละเอียดการโหวต</h2>
            <ol>
              <li>นักเรียน 1 คนสามารถโหวตได้เพียงครั้งเดียวเท่านั้น</li>
              <li>หากพบว่าข้อมูลในข้อ 1. เป็นเท็จจะไม่นับคะแนนเสียงดังกล่าว</li>
              <li>หากโหวตแล้วจะไม่สามารถแก้ไขได้</li>
              <li>กรณีที่คะแนนเสียงเท่ากัน จะตัดสินจากคะแนนสุดท้ายที่เข้ามาก่อน</li>
              <li>การตัดสินของคณะกรรมการถือเป็นที่สิ้นสุด</li>
            </ol>
          </div>
        </div>
      </form>
    </div>
  </div>
  <script src="js/jquery.min.js"></script>
  <script src="js/uikit.min.js"></script>
  <script src="js/components/lightbox.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.10.1/sweetalert2.min.js"></script>
  <footer>
    <center>สภานักเรียน</center>
  </footer>


  <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase-firestore.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyDch_xtPrfZnAHsJos_yyf59JHZMJ71byo",
      authDomain: "acsp-productdesign5.firebaseapp.com",
      databaseURL: "https://acsp-productdesign5.firebaseio.com",
      projectId: "acsp-productdesign5",
      storageBucket: "acsp-productdesign5.appspot.com",
      messagingSenderId: "759072382945"
    };
    firebase.initializeApp(config);

    let section_login = document.querySelector('.login');
    let section_vote = document.querySelector('.vote');
    let status = document.querySelector('#login-status');

    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // User is signed in.
        var displayName = user.displayName;

        status.innerHTML = "สวัสดี " + displayName + "!";

        section_login.style.display = 'none';
        section_vote.style.display = '';
        // ...
      } else {
        // User is not signed in.
        // ...
        console.log("Work!");

        status.innerHTML = "Not logged in!";
        section_login.style.display = '';
        section_vote.style.display = 'none';
      }
    });

    // Initialize Cloud Firestore through Firebase
    var db = firebase.firestore();



    function onSignInButtonClick(){

      var provider = new firebase.auth.FacebookAuthProvider();

      provider.addScope('public_profile');

      firebase.auth().signInWithPopup(provider).then(function(result) {
        if (result.credential) {
          // This gives you a Facebook Access Token. You can use it to access the Facebook API.
          var token = result.credential.accessToken;
        }
        console.log(result);

        section_login.style.display = 'none';
        section_vote.style.display = '';


        var user = result.user;
        const uid = user.uid;

        console.log(uid);

        status.innerHTML = "สวัสดี " + user.displayName + "!";
      }).catch(function(error) {
        console.log(error);
      });

      firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION)
      .then(function() {
        // Existing and future Auth states are now persisted in the current
        // session only. Closing the window would clear any existing state even
        // if a user forgets to sign out.
        // ...
        // New sign-in will be persisted with session persistence.
        console.log("Persisted!");
        return firebase.auth().FacebookAuthProvider();
      })
      .catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
      });
    }

    function onSignOutButtonClick() {
      firebase.auth().signOut().then(function() {

        status.innerHTML = "Signed out!";

        section_login.style.display = '';
        section_vote.style.display = 'none';
      }).catch(function(error) {
        // An error happened.
      });
    }

    function onVoteButtonClick() {

      swal({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        type: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, vote it!',
        cancelButtonText: 'No, cancel!',
        allowOutsideClick: false,
        showLoaderOnConfirm: true
      }).then(function () {

        var vote = parseInt(document.getElementById("style").value);
        
        var user = firebase.auth().currentUser;
        const uid = user.uid;
  
        var time = new Date().getTime();
  
        db.collection("votes").doc(uid).set({
          vote,
          time
        })
        .then(function() {
          swal({
            title: 'Voted!',
            text: 'Your vote has been submited!',
            type: 'success'
          })
          console.log("Document successfully written!");
        }).catch((e) => {
          console.log(e);
          swal({
            title: 'Invalid vote!',
            type: 'error'
          })
        });
        
      }, function (dismiss) {
        // dismiss can be 'cancel', 'overlay',
        // 'close', and 'timer'
        if (dismiss === 'cancel') {
          swal({
            title: 'Canceled!',
            type: 'error'
          })
        }
      })

      
    }
  </script>
</body>
</html>